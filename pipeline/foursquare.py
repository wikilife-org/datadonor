"""
u'response': {
            u'user': {
                u'photo': u'https: //foursquare.com/img/blank_boy.png',
                u'pings': False,
                u'homeCity': u'Mor\xf3n,
                Argentina',
                u'id': u'12083517',
                u'badges': {
                    u'count': 1,
                    u'items': [
                        {
                            u'unlockMessage': u'YouunlockedtheNewbiebadge!',
                            u'description': u'Yourfirstcheck-in!Foursquarekeepstrackofyouradventuresandmilestones,
                            likevisitingfivenewsushispotsorgalleries.Andwitheverycheck-in,
                            welearnaboutwhatyoulikeandcangiveyoubetterrecommendations.',
                            u'unlocks': [
                                {
                                    u'checkins': [
                                        {
                                            u'source': {
                                                u'url': u'https: //foursquare.com/download/#/iphone',
                                                u'name': u'foursquareforiPhone'
                                            },
                                            u'posts': {
                                                u'count': 0,
                                                u'textCount': 0
                                            },
                                            u'venue': {
                                                u'likes': {
                                                    u'count': 0,
                                                    u'groups': [
                                                        
                                                    ]
                                                },
                                                u'verified': False,
                                                u'canonicalUrl': u'https: //foursquare.com/v/fly-tango-escuela-de-vuelo/4ca54c82ae1eef3ba32b3047',
                                                u'contact': {
                                                    
                                                },
                                                u'location': {
                                                    u'city': u'Moron',
                                                    u'cc': u'AR',
                                                    u'country': u'Argentina',
                                                    u'state': u'BuenosAires,
                                                    Argentina',
                                                    u'address': u'EvaPeron2200',
                                                    u'lat': -34.67196104237061,
                                                    u'lng': -58.63703936461708
                                                },
                                                u'beenHere': {
                                                    u'count': 0
                                                },
                                                u'stats': {
                                                    u'tipCount': 0,
                                                    u'checkinsCount': 23,
                                                    u'usersCount': 10
                                                },
                                                u'id': u'4ca54c82ae1eef3ba32b3047',
                                                u'categories': [
                                                    {
                                                        u'pluralName': u'GeneralColleges&Universities',
                                                        u'primary': True,
                                                        u'name': u'GeneralCollege&University',
                                                        u'parents': [
                                                            u'College&University'
                                                        ],
                                                        u'shortName': u'Education',
                                                        u'id': u'4bf58dd8d48988d1a8941735',
                                                        u'icon': u'https: //foursquare.com/img/categories/education/default.png'
                                                    }
                                                ],
                                                u'name': u'FlyTangoEscueladeVuelo'
                                            },
                                            u'comments': {
                                                u'count': 0,
                                                u'items': [
                                                    
                                                ]
                                            },
                                            u'photos': {
                                                u'count': 0,
                                                u'items': [
                                                    
                                                ]
                                            },
                                            u'shout': u'Almorzando',
                                            u'createdAt': 1312131102,
                                            u'timeZone': u'America/Argentina/Buenos_Aires',
                                            u'type': u'checkin',
                                            u'id': u'4e35881eb61cddd1cd3e3f16',
                                            u'timeZoneOffset': -180,
                                            u'likes': {
                                                u'count': 0,
                                                u'groups': [
                                                    
                                                ]
                                            }
                                        }
                                    ]
                                }
                            ],
                            u'image': {
                                u'prefix': u'https: //playfoursquare.s3.amazonaws.com/badge/',
                                u'name': u'/newbie.png',
                                u'sizes': [
                                    57,
                                    114,
                                    200,
                                    300,
                                    400
                                ]
                            },
                            u'badgeText': u'Yourfirstcheck-in!Foursquarekeepstrackofyouradventuresandmilestones,
                            likevisitingfivenewsushispotsorgalleries.Andwitheverycheck-in,
                            welearnaboutwhatyoulikeandcangiveyoubetterrecommendations.',
                            u'badgeId': u'4c4f08667a0803bbaa202ab7',
                            u'id': u'4e35881eb61cddd1cd3e3f1a',
                            u'name': u'Newbie'
                        }
                    ]
                },
                u'friends': {
                    u'count': 2,
                    u'groups': [
                        {
                            u'count': 0,
                            u'items': [
                                
                            ],
                            u'type': u'friends',
                            u'name': u'Mutualfriends'
                        },
                        {
                            u'count': 2,
                            u'items': [
                                {
                                    u'bio': '',
                                    u'gender': u'male',
                                    u'firstName': u'Alejandro',
                                    u'relationship': u'friend',
                                    u'photo': u'https: //is1.4sqi.net/userpix_thumbs/R3PTNHLW3A1VH0LD.jpg',
                                    u'lists': {
                                        u'groups': [
                                            {
                                                u'count': 1,
                                                u'items': [
                                                    
                                                ],
                                                u'type': u'created'
                                            }
                                        ]
                                    },
                                    u'homeCity': u'Acassuso,
                                    01',
                                    u'contact': {
                                        u'twitter': u'buratonet',
                                        u'facebook': u'100004939813141',
                                        u'email': u'alejandro.burato@mac.com'
                                    },
                                    u'lastName': u'Burato',
                                    u'tips': {
                                        u'count': 1
                                    },
                                    u'id': u'51518443'
                                },
                                {
                                    u'bio': '',
                                    u'gender': u'male',
                                    u'firstName': u'Gabriel',
                                    u'relationship': u'friend',
                                    u'photo': u'https: //is1.4sqi.net/userpix_thumbs/DAGE42HBUJGRCTWD.jpg',
                                    u'lists': {
                                        u'groups': [
                                            {
                                                u'count': 1,
                                                u'items': [
                                                    
                                                ],
                                                u'type': u'created'
                                            }
                                        ]
                                    },
                                    u'homeCity': u'FlorencioVarela,
                                    Argentina',
                                    u'contact': {
                                        u'email': u'garciagabriel.ar@gmail.com'
                                    },
                                    u'lastName': u'Garcia',
                                    u'tips': {
                                        u'count': 13
                                    },
                                    u'id': u'9705467'
                                }
                            ],
                            u'type': u'others',
                            u'name': u'Otherfriends'
                        }
                    ]
                },
                u'referralId': u'u-12083517',
                u'tips': {
                    u'count': 0
                },
                u'type': u'user',
                u'todos': {
                    u'count': 0
                },
                u'bio': '',
                u'relationship': u'self',
                u'lists': {
                    u'groups': [
                        {
                            u'count': 1,
                            u'items': [
                                
                            ],
                            u'type': u'created'
                        }
                    ]
                },
                u'photos': {
                    u'count': 0,
                    u'items': [
                        
                    ]
                },
                u'checkinPings': u'off',
                u'scores': {
                    u'max': 15,
                    u'checkinsCount': 1,
                    u'goal': 50,
                    u'recent': 15
                },
                u'checkins': {
                    u'count': 3,
                    u'items': [
                        {
                            u'like': False,
                            u'source': {
                                u'url': u'https: //foursquare.com/download/#/iphone',
                                u'name': u'foursquareforiPhone'
                            },
                            u'posts': {
                                u'count': 0,
                                u'textCount': 0
                            },
                            u'venue': {
                                u'likes': {
                                    u'count': 3,
                                    u'groups': [
                                        {
                                            u'count': 3,
                                            u'items': [
                                                {
                                                    u'bio': u'Roxxiie.',
                                                    u'gender': u'female',
                                                    u'firstName': u'Roxana',
                                                    u'lastName': u'E.',
                                                    u'homeCity': u'Mor\xf3n,
                                                    BuenosAires',
                                                    u'contact': {
                                                        u'facebook': u'100001647196870'
                                                    },
                                                    u'photo': u'https: //is0.4sqi.net/userpix_thumbs/RYPJEZ3CU2OFKM44.png',
                                                    u'tips': {
                                                        u'count': 0
                                                    },
                                                    u'id': u'46785755'
                                                },
                                                {
                                                    u'bio': '',
                                                    u'gender': u'female',
                                                    u'firstName': u'Laura',
                                                    u'lastName': u'D.',
                                                    u'homeCity': u'CiudaddeBuenosAires',
                                                    u'contact': {
                                                        u'twitter': u'ldepiano',
                                                        u'facebook': u'547744861'
                                                    },
                                                    u'photo': u'https: //is1.4sqi.net/userpix_thumbs/ZHR2X0FXPFCPJCK2.jpg',
                                                    u'tips': {
                                                        u'count': 1
                                                    },
                                                    u'id': u'29387351'
                                                },
                                                {
                                                    u'bio': '',
                                                    u'gender': u'male',
                                                    u'firstName': u'Mariano',
                                                    u'lastName': u'Z.',
                                                    u'homeCity': u'CiudaddeBuenosAires',
                                                    u'contact': {
                                                        u'facebook': u'100000934938292'
                                                    },
                                                    u'photo': u'https: //is0.4sqi.net/userpix_thumbs/5BHOV2MBIE5AB44U.jpg',
                                                    u'tips': {
                                                        u'count': 5
                                                    },
                                                    u'id': u'27050332'
                                                }
                                            ],
                                            u'type': u'others'
                                        }
                                    ],
                                    u'summary': u'RoxanaE,
                                    LauraD&MarianoZ'
                                },
                                u'verified': False,
                                u'canonicalUrl': u'https: //foursquare.com/v/base-aerea-militar-mor%C3%B3n/4d597234e092a35d3c3c000c',
                                u'listed': {
                                    u'groups': [
                                        {
                                            u'count': 1,
                                            u'items': [
                                                
                                            ],
                                            u'type': u'dones'
                                        }
                                    ]
                                },
                                u'like': False,
                                u'contact': {
                                    
                                },
                                u'location': {
                                    u'city': u'Moron',
                                    u'cc': u'AR',
                                    u'country': u'Argentina',
                                    u'state': u'BuenosAires',
                                    u'address': u'EvaPer\xf3n2200',
                                    u'lat': -34.67139631946358,
                                    u'lng': -58.6366038344949
                                },
                                u'beenHere': {
                                    u'count': 1,
                                    u'marked': True
                                },
                                u'stats': {
                                    u'tipCount': 2,
                                    u'checkinsCount': 263,
                                    u'usersCount': 109
                                },
                                u'id': u'4d597234e092a35d3c3c000c',
                                u'categories': [
                                    {
                                        u'pluralName': u'Airports',
                                        u'primary': True,
                                        u'name': u'Airport',
                                        u'parents': [
                                            u'Travel&Transport'
                                        ],
                                        u'shortName': u'Airport',
                                        u'id': u'4bf58dd8d48988d1ed931735',
                                        u'icon': u'https: //foursquare.com/img/categories/travel/airport.png'
                                    }
                                ],
                                u'name': u'BaseAereaMilitarMor\xf3n'
                            },
                            u'comments': {
                                u'count': 0,
                                u'items': [
                                    
                                ]
                            },
                            u'photos': {
                                u'count': 0,
                                u'items': [
                                    
                                ]
                            },
                            u'createdAt': 1373237435,
                            u'timeZone': u'America/Argentina/Buenos_Aires',
                            u'type': u'checkin',
                            u'id': u'51d9f0bb498edc77761f904e',
                            u'timeZoneOffset': -180,
                            u'likes': {
                                u'count': 0,
                                u'groups': [
                                    
                                ]
                            }
                        }
                    ]
                },
                u'firstName': u'Joaquin',
                u'gender': u'male',
                u'contact': {
                    u'email': u'joako84@gmail.com'
                },
                u'lastName': u'Quintas',
                u'following': {
                    u'count': 0
                },
                u'requests': {
                    u'count': 0
                },
                u'mayorships': {
                    u'count': 0,
                    u'items': [
                        
                    ]
                }
            }
        }
    },
    'backend': <social_auth.backends.contrib.foursquare.FoursquareBackendobjectat0x1082330d0>,
    'pipeline_index': 12,
    'details': {
        'username': u'JoaquinQuintas',
        'first_name': u'Joaquin',
        'last_name': u'Quintas',
        'email': u'joako84@gmail.com'
    }"""

from django.utils import simplejson
from utils.client import oauth_req, dsa_urlopen, build_consumer_oauth_request
from utils.aggregated_data import complete_foursquare_info, complete_profile


def foursquare_info(request, *args, **kwargs):
    backend = kwargs.get('backend')
    social_user = kwargs.get('social_user')
    result = {}
    if backend.name == "foursquare":
        data = kwargs.get('response')["response"]["user"]
        complete_foursquare_info(social_user.user, data["friends"]["count"])
        gender = ""
        if "gender" in data:
            gender = data["gender"]
            if gender == "male":
                gender = "m"
            else:
                gender ="f"
                
        email = ""
        if "contact" in data and "email" in data["contact"]:
            email = data["contact"]["email"]
            
        complete_profile(social_user.user, email, None, gender )
        result.update(data)
        result["profile_img"] = data["photo"]
        social_user.extra_data.update(result)
        social_user.save()
          
        return result
